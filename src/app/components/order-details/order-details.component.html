<div class="order-details-container">
  <!-- Back Button -->
  <button class="back-btn" (click)="goBack()">
    ‚Üê Back to Orders
  </button>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading order details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Order Not Found</h3>
    <p>{{ errorMessage }}</p>
    <button class="back-to-orders" (click)="goBack()">Back to Orders</button>
  </div>

  <!-- Order Details -->
  <div *ngIf="!isLoading && order" class="order-details">
    <!-- Order Header -->
    <div class="order-header">
      <div class="header-left">
        <h1>Order Details</h1>
        <p class="order-number">Order #{{ order._id }}</p>
      </div>
      <div class="header-right">
        <div class="status-display">
          <span class="status-label">Status:</span>
          <span class="status-badge" [ngClass]="getStatusClass(order.status)">
            {{ getStatusText(order.status) }}
          </span>
        </div>
        <button class="print-btn" (click)="printOrder()">üñ®Ô∏è Print</button>
      </div>
    </div>

    <!-- Order Timeline -->
    <div class="timeline">
      <div class="timeline-item active">
        <div class="timeline-dot"></div>
        <div class="timeline-content">
          <h4>Order Placed</h4>
          <p>{{ formatDate(order.createdAt) }}</p>
        </div>
      </div>
      <div class="timeline-item" [class.active]="order.status === 'paid' || order.status === 'cancelled'">
        <div class="timeline-dot"></div>
        <div class="timeline-content">
          <h4>Payment</h4>
          <p>{{ order.status === 'paid' ? 'Completed' : 'Pending' }}</p>
        </div>
      </div>
    </div>

    <!-- Two Column Layout -->
    <div class="details-grid">
      <!-- Left Column: Order Items -->
      <div class="order-items">
        <h2>Order Items</h2>
        <div class="items-list">
          <div *ngFor="let item of order.items" class="item-card">
            <div class="item-image">
              <img [src]="getProductImage(item)" [alt]="item.productId?.name || 'Product'">
            </div>
            <div class="item-details">
              <h4 class="item-name">{{ item.productId?.name || 'Product' }}</h4>
              <p class="item-price">${{ item.price }} each</p>
              <div class="item-quantity">
                <span class="quantity-label">Quantity:</span>
                <span class="quantity-value">{{ item.quantity }}</span>
              </div>
              <div class="item-total">
                <span class="total-label">Subtotal:</span>
                <span class="total-value">${{ item.totalItemPrice || (item.price * item.quantity) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <h3>Order Summary</h3>
          <div class="summary-row">
            <span class="summary-label">Subtotal:</span>
            <span class="summary-value">${{ order.totalPrice }}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Shipping:</span>
            <span class="summary-value">Free</span>
          </div>
          <div class="summary-row total">
            <span class="summary-label">Total:</span>
            <span class="summary-value">${{ order.totalPrice }}</span>
          </div>
        </div>
      </div>

      <!-- Right Column: Order Info -->
      <div class="order-info">
        <!-- Payment Information -->
        <div class="info-card">
          <h3>Payment Information</h3>
          <div class="info-row">
            <span class="info-label">Payment Method:</span>
            <span class="info-value">{{ getPaymentMethodText(order.paymentMethod) }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Payment Status:</span>
            <span class="info-value" [ngClass]="{
              'status-paid': order.status === 'paid',
              'status-pending': order.status === 'pending'
            }">
              {{ order.status === 'paid' ? 'Paid' : 'Pending' }}
            </span>
          </div>
          <div *ngIf="order.paymentMethod === 'card' && order.cardDetails" class="info-row">
            <span class="info-label">Card Ending:</span>
            <span class="info-value">**** {{ order.cardDetails.cardNumber }}</span>
          </div>
        </div>

        <!-- Shipping Information -->
        <div class="info-card">
          <h3>Shipping Information</h3>
          <div class="info-row">
            <span class="info-label">Full Name:</span>
            <span class="info-value">{{ order.shippingAddress.fullName }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Address:</span>
            <span class="info-value">{{ order.shippingAddress.address }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">City:</span>
            <span class="info-value">{{ order.shippingAddress.city }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Phone:</span>
            <span class="info-value">{{ order.shippingAddress.phone }}</span>
          </div>
          <div *ngIf="order.shippingAddress?.email" class="info-row">
            <span class="info-label">Email:</span>
            <span class="info-value">{{ order.shippingAddress.email }}</span>
          </div>
        </div>

        <!-- Order Information -->
        <div class="info-card">
          <h3>Order Information</h3>
          <div class="info-row">
            <span class="info-label">Order Date:</span>
            <span class="info-value">{{ formatDate(order.createdAt) }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Order ID:</span>
            <span class="info-value id-value">{{ order._id }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Items Count:</span>
            <span class="info-value">{{ order.items.length || 0 }} items</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            *ngIf="canCancel()"
            class="cancel-btn" 
            (click)="cancelOrder()"
          >
            Cancel Order
          </button>
          <button class="contact-btn">
            Contact Support
          </button>
        </div>
      </div>
    </div>
  </div>
</div>